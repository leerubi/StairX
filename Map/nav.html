<html>
    <head>
        <h1>Stairmap</h1>
<p>계단 회피 경로를 보여줍니다.</p>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>simpleMap</title>
        <script src="https://api2.sktelecom.com/tmap/js?version=1&format=javascript&appKey=eed0e370-6591-4e53-9ae6-330623ccdc59"></script>
        <script>
   var map;
   // 페이지가 로딩이 된 후 호출하는 함수입니다.
   function initTmap(){
      // map 생성
      // Tmap.map을 이용하여, 지도가 들어갈 div, 넓이, 높이를 설정합니다.
      map = new Tmap.Map({div:'map_div', width:'100%', height:'620px'});

       markerLayer = new Tmap.Layer.Markers();
         map.addLayer(markerLayer);


      // HTML5의 geolocation으로 사용할 수 있는지 확인합니다
      if(navigator.geolocation){
         // GeoLocation을 이용해서 접속 위치를 얻어옵니다
         navigator.geolocation.getCurrentPosition(function(position){
            // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
            var lat = position.coords.latitude;
            var lon = position.coords.longitude;
            var PR_3857 = new Tmap.Projection("EPSG:3857");  // Google Mercator 좌표계인 EPSG:3857
            var PR_4326 = new Tmap.Projection("EPSG:4326");  // WGS84 GEO 좌표계인 EPSG:4326
            var lonlat = new Tmap.LonLat(lon, lat).transform(PR_4326, PR_3857);
            var size = new Tmap.Size(24, 38);
            var offset = new Tmap.Pixel(-(size.w / 2), -(size.h));
            var icon = new Tmap.Icon('http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_a.png',size, offset);

            marker = new Tmap.Marker(lonlat, icon);
            markerLayer.addMarker(marker);

            // 팝업 생성
            var popup;
            var content ="<div style=' position: relative; border-bottom: 1px solid #dcdcdc; line-height: 18px; padding: 0 35px 2px 0;'>"+
                "<div style='font-size: 12px; line-height: 15px;'>"+
                    "<span style='display: inline-block; width: 14px; height: 14px; background-image: url(/resources/images/common/icon_blet.png); vertical-align: middle; margin-right: 5px;'></span>현재위치"+
                "</div>"+
             "</div>";
            popup = new Tmap.Popup("p1", lonlat, new Tmap.Size(155, 50), content, onPopupClose);
            popup.setBorder("1px solid #8d8d8d");//popup border 조절
            popup.autoSize=true;//popup 사이즈 자동 조절
            map.addPopup(popup); // 지도에 팝업을 추가해 줍니다.
            popup.show(); // 팝업을 보여줍니다.
            map.setCenter(lonlat); // geolocation으로 얻어온 좌표로 지도의 중심을 설정합니다.
            //팝업창을 닫을수 있는 이벤트 함수
            function onPopupClose(){
               select.unselectAll();
            }
         });

      }

      var tData = new Tmap.TData();//REST API 에서 제공되는 경로, 교통정보, POI 데이터를 쉽게 처리할 수 있는 클래스입니다.

      var s_lonLat = new Tmap.LonLat(129.3222235, 36.01560872); //시작 좌표입니다.
      var e_lonLat = new Tmap.LonLat(129.321921, 36.011815); //도착 좌표입니다.

      var optionObj = {
            reqCoordType:"WGS84GEO", //요청 좌표계 옵셥 설정입니다.
            resCoordType:"EPSG3857"  //응답 좌표계 옵셥 설정입니다.
             }

      tData.getRoutePlan(s_lonLat, e_lonLat, optionObj);//경로 탐색 데이터를 콜백 함수를 통해 XML로 리턴합니다.

      tData.events.register("onComplete", tData, onComplete);//데이터 로드가 성공적으로 완료되었을 때 발생하는 이벤트를 등록합니다.
      tData.events.register("onProgress", tData, onProgress);//데이터 로드중에 발생하는 이벤트를 등록합니다.
      tData.events.register("onError", tData, onError);//데이터 로드가 실패했을 떄 발생하는 이벤트를 등록합니다.

   }

   //데이터 로드가 성공적으로 완료되었을 때 발생하는 이벤트 함수 입니다.
   function onComplete(){
      console.log(this.responseXML); //xml로 데이터를 받은 정보들을 콘솔창에서 확인할 수 있습니다.

      var trafficColors = {
         extractStyles:true,

      };

      var kmlForm = new Tmap.Format.KML(trafficColors).read(this.responseXML);
      var vectorLayer = new Tmap.Layer.Vector("vectorLayerID");
      vectorLayer.addFeatures(kmlForm);
      map.addLayer(vectorLayer);
      //경로 그리기 후 해당영역으로 줌
      map.zoomToExtent(vectorLayer.getDataExtent());
      }
   //데이터 로드중 발생하는 이벤트 함수입니다.
   function onProgress(){
      //alert("onComplete");
   }
   //데이터 로드시 에러가 발생시 발생하는 이벤트 함수입니다.
   function onError(){
      alert("onError");
   }
   // 맵 생성 실행
   initTmap();
</script>
    </head>
    <body onload="initTmap()">
        <div id="map_div">
        </div>
    </body>
</html>