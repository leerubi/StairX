<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>tmap 경로자 안내를 위한 노력</title>
    <h1>Stairmap</h1>
    <p>계단 회피 경로를 보여줍니다.</p>
        <script src="https://api2.sktelecom.com/tmap/js?version=1&format=javascript&appKey=8821d117-dbd6-4a6c-8c6b-39d11be49d00"></script>
        <!--<script src="<c:url value="/js/egovframework/mbl/cmm/jquery-1.11.2.min.js" />"></script>-->


    	<!--<link rel="shortcut icon" type="image/x-icon" href="http://tmapapi.sktelecom.com/favicon.ico">-->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/sub.css">-->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/jquery.mCustomScrollbar.css">-->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/jquery.treeview.css">-->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/default.css">-->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/jquery-ui.css">-->
<!-- 	<link rel="stylesheet" type="text/css" href="/resources/css/guide.css"> -->
<!-- 	<link rel="stylesheet" type="text/css" href="/resources/css/sample.css"> -->
	<!--<link rel="stylesheet" type="text/css" href="./step4_files/custom.css">-->

	<script type="text/javascript" src="./step4_files/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="./step4_files/jquery-ui.js"></script>
	<script type="text/javascript" src="./step4_files/jquery.easing.min.js"></script>
	<script type="text/javascript" src="./step4_files/jquery.ui.touch-punch.min.js"></script>
	<script type="text/javascript" src="./step4_files/placeholder.js"></script>
	<script type="text/javascript" src="./step4_files/jquery.mCustomScrollbar.concat.min.js"></script>
	<script type="text/javascript" src="./step4_files/jquery.treeview.js"></script>
	<script type="text/javascript" src="./step4_files/highlight.pack.js"></script>
	<script type="text/javascript" src="./step4_files/jquery.mousewheel.min.js"></script>
	<script type="text/javascript" src="./step4_files/common.js"></script>
	<script type="text/javascript" src="./step4_files/w3.js"></script>
	<script type="text/javascript" src="./step4_files/highlight.pack.js"></script>
	<!--<script src="./step4_files/js"></script><link rel="stylesheet" href="./step4_files/style.css" type="text/css"><script src="./step4_files/Core.js"></script><script src="./step4_files/Format.js"></script><script src="./step4_files/Add-on.js"></script>-->
	<script type="text/javascript" src="./step4_files/shCore.js"></script>
	<script type="text/javascript" src="./step4_files/shBrushJScript.js"></script>
	<script type="text/javascript" src="./step4_files/shBrushXml.js"></script>
	<!--<link type="text/css" rel="stylesheet" href="./step4_files/shCoreDefault.css">-->

	<!-- CodeMirror -->
	<script src="./step4_files/codemirror.js"></script>
	<!--<link rel="stylesheet" href="./step4_files/codemirror.css">-->
	<!--<link rel="stylesheet" href="./step4_files/xq-light.css">-->
	<!--<link rel="stylesheet" href="./step4_files/panda-syntax.css">-->
	<script src="./step4_files/javascript.js"></script>

	<!--<style type="text/css">-->
		<!--.syntaxhighlighter {-->
		    <!--height: 600px;-->
		    <!--width: 840px !important;-->
		    <!--overflow-y: auto !important;-->
		    <!--overflow-x: auto !important;-->
		<!--}-->

		<!--/* 검색결과 디자인 관련 - START */-->
		<!--#search_result a  {-->
			<!--color: #cccccc-->
		<!--}-->
		<!--#search_result span {-->
			<!--color: #ffffff-->
		<!--}-->
		<!--/* 검색결과 디자인 관련 - END */-->
	<!--</style>-->

        <script type="text/javascript">
                function initTmap(){
                    var map = new Tmap.Map({
                        div:'map_div',
                        width : "100%",
                        height : "452px",
                    });
                    map.setCenter(new Tmap.LonLat("127.058908811749", "37.52084364186228").transform("EPSG:4326", "EPSG:3857"), 12);
                    routeLayer = new Tmap.Layer.Vector("route");
                    map.addLayer(routeLayer);

                    markerStartLayer = new Tmap.Layer.Markers("start");
                    markerEndLayer = new Tmap.Layer.Markers("end");
                    markerWaypointLayer = new Tmap.Layer.Markers("waypoint");
                    markerWaypointLayer2 = new Tmap.Layer.Markers("waypoint2");
                    pointLayer = new Tmap.Layer.Vector("point");

                    // 2. 시작, 도착 심볼찍기
                    // 시작
                    map.addLayer(markerStartLayer);

                    var size = new Tmap.Size(24, 38);
                    var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
                    var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_s.png' />", size, offset);
                    var marker_s = new Tmap.Marker(new Tmap.LonLat("127.02810900563199", "37.519892712436906").transform("EPSG:4326", "EPSG:3857"), icon);
                    markerStartLayer.addMarker(marker_s);

                    // 도착
                    map.addLayer(markerEndLayer);

                    var size = new Tmap.Size(24, 38);
                    var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
                    var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_r_m_e.png' />", size, offset);
                    var marker_e = new Tmap.Marker(new Tmap.LonLat("127.13281976335786", "37.52130314703887").transform("EPSG:4326", "EPSG:3857"), icon);
                    markerEndLayer.addMarker(marker_e);

                    //경유지 마커 제거
                    markerWaypointLayer.clearMarkers();
                    markerWaypointLayer2.clearMarkers();

                    // 3. 경유지 심볼 찍기
                    map.addLayer(markerWaypointLayer);

                    var size = new Tmap.Size(24, 38);
                    var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
                    var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_p.png' />", size, offset);
                    var marker = new Tmap.Marker(new Tmap.LonLat("127.04724656694417","37.524162226778515").transform("EPSG:4326", "EPSG:3857"), icon);
                    markerWaypointLayer.addMarker(marker);

                    var size = new Tmap.Size(24, 38);
                    var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
                    var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_p.png' />", size, offset);
                    var marker = new Tmap.Marker(new Tmap.LonLat("127.10887300128256","37.5289781669373").transform("EPSG:4326", "EPSG:3857"), icon);
                    markerWaypointLayer.addMarker(marker);

                    markerWaypointLayer2.clearMarkers();

    // 4. 경로 탐색 API 사용요청
var startX = 127.02810900563199;
var startY = 37.519892712436906;
var endX = 127.13281976335786;
var endY = 37.52130314703887;
var passList = "127.04724656694417,37.524162226778515_127.10887300128256,37.5289781669373";
var prtcl;
var headers = {};
headers["appKey"]="8821d117-dbd6-4a6c-8c6b-39d11be49d00";
$.ajax({
		method:"POST",
		headers : headers,
		url:"https://api2.sktelecom.com/tmap/routes?version=1&format=xml",//
		async:false,
		data:{
			startX : startX,
			startY : startY,
			endX : endX,
			endY : endY,
			passList : passList,
			reqCoordType : "WGS84GEO",
			resCoordType : "EPSG3857",
			angle : "172",
			searchOption : "0",
			trafficInfo : "Y" //교통정보 표출 옵션입니다.
		},
		success:function(response){
			prtcl = response;

		//5. 경로탐색 결과 Line 그리기
		//출발지,도착지 마커 제거
		markerStartLayer.clearMarkers();
		markerEndLayer.clearMarkers();
		//경유지 마커 제거
		markerWaypointLayer.clearMarkers();

		var trafficColors = {
				extractStyles:true,

				/* 실제 교통정보가 표출되면 아래와 같은 Color로 Line이 생성됩니다. */
				trafficDefaultColor:"#000000", //Default
				trafficType1Color:"#009900", //원할
				trafficType2Color:"#8E8111", //지체
				trafficType3Color:"#FF0000", //정체

			};
		var kmlForm = new Tmap.Format.KML(trafficColors).readTraffic(prtcl);
		routeLayer = new Tmap.Layer.Vector("vectorLayerID"); //백터 레이어 생성
		routeLayer.addFeatures(kmlForm); // 교통정보를 백터 레이어에 추가

		map.addLayer(routeLayer); // 지도에 백터 레이어 추가

		markerWaypointLayer2 = new Tmap.Layer.Markers("waypoint2");
		map.addLayer(markerWaypointLayer2);

		var size = new Tmap.Size(24, 38);
		var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
		var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_p.png' />", size, offset);
		var marker = new Tmap.Marker(new Tmap.LonLat("127.07389565460413","37.5591696189164").transform("EPSG:4326", "EPSG:3857"), icon);
		markerWaypointLayer2.addMarker(marker);

		var size = new Tmap.Size(24, 38);
		var offset = new Tmap.Pixel(-(size.w / 2), -size.h);
		var icon = new Tmap.IconHtml("<img src='http://tmapapis.sktelecom.com/upload/tmap/marker/pin_b_m_p.png' />", size, offset);
		var marker = new Tmap.Marker(new Tmap.LonLat("127.13346617572014", "37.52127761904626").transform("EPSG:4326", "EPSG:3857"), icon);
		markerWaypointLayer2.addMarker(marker);



	},
	error:function(request,status,error){
		console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
	}
});







         }
      </script>
    </head>
    <body onload="initTmap()">
        <div id="map_div">
        </div>
    </body>
</html>